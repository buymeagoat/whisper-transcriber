<!DOCTYPE html>
<html>
<head>
    <title>Whisper Transcriber</title>
    <style>
        #options, #results {
            display: none;
            margin-top: 20px;
        }
        .description {
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>Upload Audio for Transcription</h1>

    <input type="file" id="audioFile" accept=".mp3,.m4a,.wav,.flac"><br><br>

    <div id="results">
        <strong>Detected Language:</strong> <span id="langDisplay"></span><br>
        <strong>Duration:</strong> <span id="durationDisplay"></span><br>
    </div>

    <form id="transcribeForm" action="/upload" method="post" enctype="multipart/form-data">
        <!-- file input will be added dynamically -->

        <div id="options">
            <label for="model">Model:</label>
            <select name="model" id="model">
                <option value="tiny">Tiny – Fastest, lowest accuracy</option>
                <option value="small">Small – Balanced speed & accuracy</option>
                <option value="base" selected>Base – Good default</option>
                <option value="medium">Medium – Slower, high accuracy</option>
                <option value="large">Large – Slowest, best accuracy</option>
            </select><br><br>

            <label for="format">Format:</label>
            <select name="format" id="format">
                <option value="txt">TXT – Plain text</option>
                <option value="srt">SRT – SubRip subtitles with timestamps</option>
                <option value="vtt">VTT – Web Video Text Tracks</option>
            </select><br><br>

            <label>
                <input type="checkbox" name="timestamps">
                Include timestamps (if format supports it)
            </label><br><br>

            <label>Segment:</label>
            <input type="radio" name="segment" value="full" checked> Full audio<br>
            <input type="radio" name="segment" value="partial"> Start:
            <input type="number" name="start" min="0" placeholder="sec"> End:
            <input type="number" name="end" min="0" placeholder="sec"><br><br>

            <input type="submit" value="Transcribe">
        </div>
    </form>

    <script>
        const audioInput = document.getElementById("audioFile");
        const resultsDiv = document.getElementById("results");
        const optionsDiv = document.getElementById("options");
        const langDisplay = document.getElementById("langDisplay");
        const durationDisplay = document.getElementById("durationDisplay");
        const form = document.getElementById("transcribeForm");

        audioInput.addEventListener("change", async function () {
            const file = audioInput.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append("file", file);

            const response = await fetch("/analyze_audio", {
                method: "POST",
                body: formData
            });

            const result = await response.json();

            if (result.error) {
                alert("Error: " + result.error);
                return;
            }

            langDisplay.textContent = result.language;
            durationDisplay.textContent = result.duration_str;

            resultsDiv.style.display = "block";
            optionsDiv.style.display = "block";

            // Create a real input[type=file] that can be submitted
            const realInput = document.createElement("input");
            realInput.type = "file";
            realInput.name = "file";
            realInput.files = audioInput.files;
            realInput.style.display = "none";
            form.appendChild(realInput);
        });
    </script>
</body>
</html>
